# AI Coding Guidelines for RLT Svelte Client

- **Stack & entry points**: SvelteKit SPA (SSR disabled in src/routes/+layout.ts). Global shell in src/routes/+layout.svelte pulls in app.css, sets Roboto font, and renders MenuBar for authenticated users.
- **Dev commands**: npm install; npm run dev for local; npm run build for production bundle; npm run preview to serve build; npm run format to apply Prettier + Svelte plugin.
- **Architecture docs**: High-level screens/components in docs/RLT.md; guard system overview and examples in docs/GUARDS.md.
- **API layer**: All backend calls go through src/lib/api.ts (API_BASE_URL=http://localhost:5122). Use helpers (createPlayer, getPlayerByFirebaseUserId, getPlayerLabels, createLabel, fetchScoutingScopes, createScoutingTask, predictScoutingCost, fetchLabelTasks, claimTask). Task creation can throw TaskCreationError when backend returns {code,message}; handle specifically.
- **Auth & state flow**: Firebase auth wrappers in src/lib/firebase.ts; authStore/isAuthenticated/authLoading in src/lib/stores/auth.ts track Firebase user and initialization. initializeAuthState in src/lib/services/auth.ts populates player/label stores on auth change. Public routes are listed in +layout.svelte; non-public routes redirect to /users/login if unauthenticated.
- **Login/Register flows**: Users login/register pages call firebaseSignIn/firebaseCreateAccount then backend player creation/fetch via api.ts; on success they set player store and either load first label or send to /labels/create. googleSignInAndRedirect handles fallback player creation when none exists.
- **Navigation**: Use goto from $app/navigation for route changes; avoid window.location.
- **Guards**: Guard utilities in src/lib/guards/index.ts + types.ts; reusable rules in src/lib/guards/rules.ts (requireLabel, requirePlayer, preventAccess, allowAccess). executeGuards throws redirect on failure; stopOnFirstFailure defaults true. Home +page.ts uses preventAccess to redirect to /labels; guards for labels dashboard currently commented but kept for reuse.
- **State stores**: player and label writable stores in src/lib/stores/player.ts and src/lib/stores/label.ts (updateLabelBankroll helper). Scouting tasks store in src/lib/stores/tasks.ts. modalStore in src/lib/stores/modal.ts manages modal type/data.
- **Modal/task pattern**: Task modal entry at src/lib/components/modals/TaskModal.svelte with sub-modals under task-submodals/. Labels dashboard (src/routes/labels/+page.svelte) opens modals via modalStore, fetches tasks for current label, auto-claims finished tasks via claimTask, and keeps server/client time in sync using x-server-time header.
- **Data models**: Types under src/lib/types/. Scouting enums/status/cost prediction in src/lib/types/scouting.ts; Label/Player interfaces in src/lib/types/label.ts and src/lib/types/player.ts; rap music styles enum + names in src/lib/types/musicStyles.ts.
- **UI components**: Shared components in src/lib/components (Button, Modal, MenuBar, form fields, etc.). RLT component specs outlined in docs/RLT.md (e.g., numeric input field emits currentValue, stepper emits stepClicked).
- **Styling**: Tailwind configured via tailwind.config.js/postcssâ€”default to Tailwind utility classes for layout/spacing/color. app.css loads theme tokens from src/lib/theme.ts and sets base styles. Use provided Button/Stepper/Chip components before adding new primitives.
- **Assets/fonts**: Google Roboto font preconnected in +layout.svelte; hero images and other artwork live in src/lib/assets/.
- **Routing map**: Feature folders under src/routes mirror product areas (users/login|register, labels/create|dashboard, artists/detail/[id], etc.). Keep new routes co-located by feature with +page.svelte/+page.ts pairs.
- **Error handling expectations**: Surface user-friendly messages for auth/api failures (see login/register pages). For fetchLabelTasks, handle non-OK responses with meaningful error text.
- **Testing status**: No automated tests configured; manually verify flows when adding guards/auth/api changes.
