import{d as Y,i as x,a as $}from"./DcUeqTlN.js";import{s as ee,n as j,d as m,Q as z,i as T,l as d,c as D,e as _,h as w,m as te,o as ae,b as g,R as C,g as R,p as G,S as q,j as A,a as I,f as V,t as L}from"./DjsGgg0N.js";import{e as H}from"./BV4LPSyA.js";import{S as re,i as se}from"./cWIQy_G5.js";async function ne(t,e){const a=new URLSearchParams;e!=null&&e.fromDate&&a.append("fromDate",e.fromDate),e!=null&&e.toDate&&a.append("toDate",e.toDate);const l=a.toString(),s=`/api/v1/track-performance-reports/by-label/${t}${l?`?${l}`:""}`;return Y(s)}function N(t){if(t.length===0)return{totalStreams:0,totalSales:0,totalRevenue:0,reportCount:0,averageDecayFactor:0};const e=t.reduce((a,l)=>({streams:a.streams+l.performanceStatsForThePeriod.streams,sales:a.sales+l.performanceStatsForThePeriod.sales,revenue:a.revenue+l.performanceStatsForThePeriod.revenue,decayFactor:a.decayFactor+l.decayFactor}),{streams:0,sales:0,revenue:0,decayFactor:0});return{totalStreams:e.streams,totalSales:e.sales,totalRevenue:e.revenue,reportCount:t.length,averageDecayFactor:e.decayFactor/t.length}}function U(t,e="revenue"){if(t.length<2)return 0;const a=[...t].sort((n,r)=>new Date(r.reportDate).getTime()-new Date(n.reportDate).getTime()),l=a[0].performanceStatsForThePeriod[e],s=a[1].performanceStatsForThePeriod[e];return s===0?l>0?100:0:(l-s)/s*100}function ge(t,e,a){const l=new Map(e.map(r=>[r.id,r])),s=new Map(a.map(r=>[r.id,r])),n=new Map;return t.forEach(r=>{const o=l.get(r.trackId);if(!o)return;const u=a.find(i=>i.trackIds.includes(o.id));u&&(n.has(u.id)||n.set(u.id,[]),n.get(u.id).push(r))}),Array.from(n.entries()).map(([r,o])=>{const u=s.get(r);return{releaseId:r,releaseTitle:u.title,stats:N(o),reports:o,trend:U(o)}})}function be(t,e,a){const l=new Map(e.map(n=>[n.id,n])),s=new Map;return t.forEach(n=>{const r=l.get(n.trackId);r&&r.artistId.forEach(o=>{s.has(o)||s.set(o,[]),s.get(o).push(n)})}),Array.from(s.entries()).map(([n,r])=>{const o=a.get(n);return{artistId:n,artistName:(o==null?void 0:o.name)||"Unknown Artist",stats:N(r),reports:r,trend:U(r)}})}function _e(t,e,a,l){const s=new Map(e.map(r=>[r.id,r])),n=new Map;return t.forEach(r=>{n.has(r.trackId)||n.set(r.trackId,[]),n.get(r.trackId).push(r)}),Array.from(n.entries()).map(([r,o])=>{const u=s.get(r);if(!u)return{trackId:r,trackTitle:"Unknown Track",artistNames:[],stats:N(o),reports:o,trend:U(o)};const i=u.artistId.map(c=>{var v;return(v=l.get(c))==null?void 0:v.name}).filter(Boolean),f=a.find(c=>c.trackIds.includes(r));return{trackId:r,trackTitle:u.title,artistNames:i,releaseTitle:f==null?void 0:f.title,stats:N(o),reports:o,trend:U(o)}})}function pe(t,e,a=!1){return[...t].sort((s,n)=>{let r=0,o=0;switch(e){case"revenue":r=s.stats.totalRevenue,o=n.stats.totalRevenue;break;case"streams":r=s.stats.totalStreams,o=n.stats.totalStreams;break;case"sales":r=s.stats.totalSales,o=n.stats.totalSales;break}return a?r-o:o-r})}function le(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}function oe(t){return t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString()}function ye(t){return`${t>=0?"+":""}${t.toFixed(1)}%`}function De(t){const e=new Date,a=new Date;return a.setDate(a.getDate()-t),{fromDate:a.toISOString(),toDate:e.toISOString()}}function we(t,e){return x({queryKey:[...$.performanceReports,"byLabel",t,e],queryFn:()=>ne(t,e),enabled:!!t,staleTime:5*60*1e3})}function J(t,e,a){const l=t.slice();return l[11]=e[a],l}function ie(t){let e,a,l,s,n,r=H(t[3]),o=[];for(let i=0;i<r.length;i+=1)o[i]=W(J(t,r,i));let u=t[1]&&t[3].length>0&&X(t);return{c(){e=q("svg"),a=q("path"),l=q("path");for(let i=0;i<o.length;i+=1)o[i].c();s=A(),u&&u.c(),n=G(),this.h()},l(i){e=C(i,"svg",{viewBox:!0,preserveAspectRatio:!0,class:!0});var f=_(e);a=C(f,"path",{d:!0,class:!0}),_(a).forEach(m),l=C(f,"path",{d:!0,class:!0}),_(l).forEach(m);for(let c=0;c<o.length;c+=1)o[c].l(f);f.forEach(m),s=R(i),u&&u.l(i),n=G(),this.h()},h(){d(a,"d",t[5]),d(a,"class","chart-area svelte-1owbb20"),d(l,"d",t[2]),d(l,"class","chart-line svelte-1owbb20"),d(e,"viewBox","0 0 100 100"),d(e,"preserveAspectRatio","none"),d(e,"class","chart-svg svelte-1owbb20")},m(i,f){T(i,e,f),g(e,a),g(e,l);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);T(i,s,f),u&&u.m(i,f),T(i,n,f)},p(i,f){if(f&32&&d(a,"d",i[5]),f&4&&d(l,"d",i[2]),f&8){r=H(i[3]);let c;for(c=0;c<r.length;c+=1){const v=J(i,r,c);o[c]?o[c].p(v,f):(o[c]=W(v),o[c].c(),o[c].m(e,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=r.length}i[1]&&i[3].length>0?u?u.p(i,f):(u=X(i),u.c(),u.m(n.parentNode,n)):u&&(u.d(1),u=null)},d(i){i&&(m(e),m(s),m(n)),ae(o,i),u&&u.d(i)}}}function ce(t){let e,a="No data available";return{c(){e=w("div"),e.textContent=a,this.h()},l(l){e=D(l,"DIV",{class:!0,"data-svelte-h":!0}),te(e)!=="svelte-oq4agj"&&(e.textContent=a),this.h()},h(){d(e,"class","no-data svelte-1owbb20")},m(l,s){T(l,e,s)},p:j,d(l){l&&m(e)}}}function W(t){let e,a,l;return{c(){e=q("circle"),this.h()},l(s){e=C(s,"circle",{cx:!0,cy:!0,r:!0,class:!0}),_(e).forEach(m),this.h()},h(){d(e,"cx",a=t[11].x),d(e,"cy",l=t[11].y),d(e,"r","1"),d(e,"class","chart-point svelte-1owbb20")},m(s,n){T(s,e,n)},p(s,n){n&8&&a!==(a=s[11].x)&&d(e,"cx",a),n&8&&l!==(l=s[11].y)&&d(e,"cy",l)},d(s){s&&m(e)}}}function X(t){let e,a,l,s=B(t[3][0].date)+"",n,r,o,u=t[6](t[3][0].value)+"",i,f,c,v,k=B(t[3][t[3].length-1].date)+"",h,y,S,F=t[6](t[3][t[3].length-1].value)+"",M;return{c(){e=w("div"),a=w("div"),l=w("div"),n=L(s),r=A(),o=w("div"),i=L(u),f=A(),c=w("div"),v=w("div"),h=L(k),y=A(),S=w("div"),M=L(F),this.h()},l(b){e=D(b,"DIV",{class:!0});var p=_(e);a=D(p,"DIV",{class:!0});var E=_(a);l=D(E,"DIV",{class:!0});var K=_(l);n=V(K,s),K.forEach(m),r=R(E),o=D(E,"DIV",{class:!0});var Q=_(o);i=V(Q,u),Q.forEach(m),E.forEach(m),f=R(p),c=D(p,"DIV",{class:!0});var P=_(c);v=D(P,"DIV",{class:!0});var O=_(v);h=V(O,k),O.forEach(m),y=R(P),S=D(P,"DIV",{class:!0});var Z=_(S);M=V(Z,F),Z.forEach(m),P.forEach(m),p.forEach(m),this.h()},h(){d(l,"class","label-date svelte-1owbb20"),d(o,"class","label-value svelte-1owbb20"),d(a,"class","label-start svelte-1owbb20"),d(v,"class","label-date svelte-1owbb20"),d(S,"class","label-value svelte-1owbb20"),d(c,"class","label-end svelte-1owbb20"),d(e,"class","chart-labels svelte-1owbb20")},m(b,p){T(b,e,p),g(e,a),g(a,l),g(l,n),g(a,r),g(a,o),g(o,i),g(e,f),g(e,c),g(c,v),g(v,h),g(c,y),g(c,S),g(S,M)},p(b,p){p&8&&s!==(s=B(b[3][0].date)+"")&&I(n,s),p&8&&u!==(u=b[6](b[3][0].value)+"")&&I(i,u),p&8&&k!==(k=B(b[3][b[3].length-1].date)+"")&&I(h,k),p&8&&F!==(F=b[6](b[3][b[3].length-1].value)+"")&&I(M,F)},d(b){b&&m(e)}}}function ue(t){let e;function a(n,r){return n[4].length===0?ce:ie}let l=a(t),s=l(t);return{c(){e=w("div"),s.c(),this.h()},l(n){e=D(n,"DIV",{class:!0,style:!0});var r=_(e);s.l(r),r.forEach(m),this.h()},h(){d(e,"class","chart-container svelte-1owbb20"),z(e,"height",t[0]+"px")},m(n,r){T(n,e,r),s.m(e,null)},p(n,[r]){l===(l=a(n))&&s?s.p(n,r):(s.d(1),s=l(n),s&&(s.c(),s.m(e,null))),r&1&&z(e,"height",n[0]+"px")},i:j,o:j,d(n){n&&m(e),s.d()}}}function B(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"})}function fe(t,e,a){let l,s,n,r,o,u,{reports:i=[]}=e,{metric:f="revenue"}=e,{height:c=200}=e,{showLabels:v=!0}=e;function k(h){return f==="revenue"?le(h):oe(h)}return t.$$set=h=>{"reports"in h&&a(7,i=h.reports),"metric"in h&&a(8,f=h.metric),"height"in h&&a(0,c=h.height),"showLabels"in h&&a(1,v=h.showLabels)},t.$$.update=()=>{t.$$.dirty&128&&a(9,l=[...i].sort((h,y)=>new Date(h.reportDate).getTime()-new Date(y.reportDate).getTime())),t.$$.dirty&768&&a(4,s=l.map(h=>h.performanceStatsForThePeriod[f])),t.$$.dirty&16&&a(10,n=Math.max(...s,1)),t.$$.dirty&1552&&a(3,r=s.map((h,y)=>{var M;const S=y/Math.max(s.length-1,1)*100,F=100-h/n*100;return{x:S,y:F,value:h,date:(M=l[y])==null?void 0:M.reportDate}})),t.$$.dirty&8&&a(2,o=r.map((h,y)=>`${y===0?"M":"L"} ${h.x} ${h.y}`).join(" ")),t.$$.dirty&4&&a(5,u=`${o} L 100 100 L 0 100 Z`)},[c,v,o,r,s,u,k,i,f,l,n]}class Se extends re{constructor(e){super(),se(this,e,fe,ue,ee,{reports:7,metric:8,height:0,showLabels:1})}}export{Se as P,ge as a,be as b,we as c,_e as d,oe as e,le as f,De as g,ye as h,pe as s};
